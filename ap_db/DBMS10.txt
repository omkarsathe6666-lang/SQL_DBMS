//-----------------------------------------
// 1Ô∏è‚É£ Use / Create Database
//-----------------------------------------
use LibraryDB

//-----------------------------------------
// 2Ô∏è‚É£ Create Collections
//-----------------------------------------
db.createCollection("Books")
db.createCollection("Products")

//-----------------------------------------
// 3Ô∏è‚É£ Insert Sample Documents
//-----------------------------------------
db.Books.insertMany([
  { book_id: 1, book_title: "MongoDB Basics", author_name: "John Doe", publish_year: 2014 },
  { book_id: 2, book_title: "Advanced MongoDB", author_name: "John Doe", publish_year: 2018 },
  { book_id: 3, book_title: "NoSQL for Beginners", author_name: "Alice Smith", publish_year: 2019 },
  { book_id: 4, book_title: "Data Science with MongoDB", author_name: "Bob Martin", publish_year: 2021 },
  { book_id: 5, book_title: "Database Design", author_name: "Alice Smith", publish_year: 2013 }
])

db.Products.insertMany([
  { product_id: 1, name: "Notebook", price: 50 },
  { product_id: 2, name: "Pen", price: 20 },
  { product_id: 3, name: "Book Stand", price: 250 },
  { product_id: 4, name: "Lamp", price: 800 },
  { product_id: 5, name: "Table", price: 1200 }
])

//-----------------------------------------
// 4Ô∏è‚É£ Create Indexes
//-----------------------------------------
db.Products.createIndex({ price: 1 })                   // Index on price
db.Books.createIndex({ author_name: 1, publish_year: -1 }) // Compound index

//-----------------------------------------
// 5Ô∏è‚É£ View Indexes
//-----------------------------------------
db.Books.getIndexes()
db.Products.getIndexes()

//-----------------------------------------
// 6Ô∏è‚É£ Drop price index from Products
//-----------------------------------------
db.Products.dropIndex("price_1")

//-----------------------------------------
// 7Ô∏è‚É£ Aggregation: Total books per author
//-----------------------------------------
db.Books.aggregate([
  { $group: { _id: "$author_name", total_books: { $sum: 1 } } }
])

//-----------------------------------------
// 8Ô∏è‚É£ Aggregation: Average price of all products
//-----------------------------------------
db.Products.aggregate([
  { $group: { _id: null, avg_price: { $avg: "$price" } } }
])

//-----------------------------------------
// 9Ô∏è‚É£ Aggregation: Max and Min price of products
//-----------------------------------------
db.Products.aggregate([
  { $group: { _id: null, max_price: { $max: "$price" }, min_price: { $min: "$price" } } }
])

//-----------------------------------------
// üîü Count books published after 2015
//-----------------------------------------
db.Books.aggregate([
  { $match: { publish_year: { $gt: 2015 } } },
  { $count: "Books_Published_After_2015" }
])

//-----------------------------------------
// 11Ô∏è‚É£ Project only book_title and author_name
//-----------------------------------------
db.Books.aggregate([
  { $project: { _id: 0, book_title: 1, author_name: 1 } }
])

//-----------------------------------------
// 12Ô∏è‚É£ Sort Books by publish_year descending
//-----------------------------------------
db.Books.find().sort({ publish_year: -1 })
